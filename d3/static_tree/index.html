<!DOCTYPE html>
<html>

<head>
    <title>Simple Tree Demo 2</title>
    <script src="http://d3js.org/d3.v3.js"></script>
    <style>
        .link {
            fill: none;
            stroke: #ccc;
            stroke-width: 1.5px;
        }

        div.tooltip {
            position: absolute;
            text-align: center;
            width: 100px;
            height: 100px;
            padding: 8px;
            font: 10px sans-serif;
            background: #ffff99;
            border: solid 1px #aaa;
            border-radius: 8px;
            pointer-events: none;
        }
    </style>
</head>

<body>
<div id="viz"></div>
<script type="text/javascript">
    //JSON object with the data
    var treeData = {
        "name": "node0",
        "attribute": "milk <= 0.5",
        "parent": "null",
        "samples": 101,
        "distribution": [4, 20, 8, 13, 10, 41, 5],
        "children": [
            {
                "name": "Level 2: A",
                "attribute": "none; leaf",
                "parent": "Top Parent",
                "samples": 41,
                "distribution": [4, 20, 8, 13, 10, 0, 5],
            },
            {
                "name": "Level 2: B",
                "attribute": "feathers <= 0.5",
                "parent": "Top Level",
                "samples": 60,
                "distribution": [4, 20, 8, 13, 10, 41, 5],
                "children": [
                    {
                        "name": "Son of A",
                        "attribute": "none; leaf",
                        "parent": "Level 2: A",
                        "samples": 20,
                        "distribution": [4, 0, 8, 13, 10, 0, 5],
                    },
                    {
                        "name": "Daughter of A",
                        "attribute": "fins <= 0.5",
                        "parent": "Level 2: A",
                        "samples": 40,
                        "distribution": [4, 0, 8, 0, 10, 0, 5],
                    }
                ]
            }
        ]
    }

    // Create a svg canvas
    var vis = d3.select("#viz").append("svg:svg")
        .attr("width", 400)
        .attr("height", 300)
        .append("svg:g")
        .attr("transform", "translate(40, 30)"); // shift everything to the right


    // Add tooltip div
    var div = d3.select("body").append("div")
        .attr("class", "tooltip")
        .html("<p>This is a SVG inside a tooltip:</p><div id='tipDiv'>hi</div>")
        .style("opacity", 1e-6);


    // Create a tree "canvas"
    var tree = d3.layout.tree()
        .size([300, 150]);

    var diagonal = d3.svg.diagonal();

    // Preparing the data for the tree layout, convert data into an array of nodes
    var nodes = tree.nodes(treeData);
    // Create an array with all the links
    var links = tree.links(nodes);

    console.log("Raw:")
    console.log(treeData)
    console.log("Nodes:")
    console.log(nodes)
    console.log("Links:")
    console.log(links)

    // Show me a link in raw and its path version
    console.log(links[0])
    console.log(diagonal(links[0]))

    var link = vis.selectAll("pathlink")
        .data(links)
        .enter().append("svg:path")
        .attr("class", "link")
        .attr("d", diagonal)

    var node = vis.selectAll("g.node")
        .data(nodes)
        .enter().append("svg:g")
        .attr("transform", function (d) {
            return "translate(" + d.x + "," + d.y + ")";
        })

    // Add the dot at every node
    node.append("svg:circle")
        .on("mouseover", mouseover)
        .on("mousemove", function (d) {
            mousemove(d);
        })
        .on("mouseout", mouseout)
        .attr("fill", "red")
        .attr("r", 5.5);

    node.append("svg:text")
        .attr("dx", 8)
        .attr("dy", 3)
        .text(function (d) {
            return d.name;
        })

    function mouseover() {
        div.transition()
            .duration(300)
            .style("opacity", 1);
    }


    function mousemove(d) {
        console.log("inside select")
        var dataset = [80, 100, 56, 120, 180, 30, 40, 120, 160];
        var svgWidth = 200;
        var svgHeight = 100
        var barPadding = 5;
        var barWidth = (svgWidth / dataset.length);

        div
            .text("Info about " + d.name + ":" + d.info + "\n" + d.attribute)
            .attr("transform", "translate(0," + 5 + ")")
            .style("left", (d3.event.pageX) + "px")
            .style("top", (d3.event.pageY) + "px")
            .attr("class", "tooltip")
            .append("svg")
            .data(dataset)
            .enter()
            .append("rect")
            .attr("y", function (d) {
                return svgHeight - d
            })
            .attr("height", function (d) {
                return d;
            })
            .attr("width", barWidth - barPadding)
            .attr("transform", function (d, i) {
                var translate = [barWidth * i, 0];
                return "translate(" + translate + ")";
            });

        // .style("opacity", 1e-6);


        // .call(wrap, 40);
    }


    function mouseout() {
        div.transition()
            .duration(300)
            .style("opacity", 1e-6);
    }
</script>
</body>

</html>